<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="website.hehe.mapper.AppealMapper">

    <resultMap id="BaseResultMap" type="website.hehe.pojo.Appeal">
        <id property="appealId" column="appeal_id" jdbcType="INTEGER"/>
        <result property="appealStatus" column="appeal_status" jdbcType="INTEGER"/>
        <result property="appealReason" column="appeal_reason" jdbcType="VARCHAR"/>
        <result property="studentId" column="student_id" jdbcType="INTEGER"/>
        <result property="version" column="version" jdbcType="INTEGER"/>
        <result property="isDeleted" column="is_deleted" jdbcType="INTEGER"/>
    </resultMap>

    <sql id="Base_Column_List">
        appeal_id,appeal_status,appeal_reason,
        version,is_deleted
    </sql>

    <!--GENERATED BY POWERFUL CHATGPT!!! GG!!!-->
    <select id="selectAppealByUserId" resultType="java.util.Map">
        SELECT log.appeal_id, appeal.appeal_status, appeal.appeal_reason
        FROM student
                 JOIN log ON student.student_id = log.student_id
                 JOIN appeal ON log.appeal_id = appeal.appeal_id
        WHERE student.student_id = #{userId};
    </select>

    <update id="updateAppealsByAppealId">
        UPDATE appeal
        SET appeal_status = #{appealStatus},
            appeal_reason = #{appealReason}
        WHERE appeal_id IN (SELECT appeal_id FROM log WHERE student_id = #{userId})
          AND appeal_id = #{appealId};
    </update>
</mapper>
